#!/bin/bash

#REFERENCES: https://www.baeldung.com/linux/insert-line-specific-line-number


#colors
RED="\x1B[31m"
GRN="\x1B[1;32m"
YEL="\x1B[33m"
BLU="\x1B[34m"
MAG="\x1B[35m"
BMAG="\x1B[1;35m"
CYN="\x1B[36m"
BCYN="\x1B[1;36m"
WHT="\x1B[37m"
RESET="\x1B[0m"
LINEP="\033[40G"

exe=$(find ../ -name miniRT)
incorrect_map=$(find ./ -name incorrect_maps)
incorrect_maps=$(cd $incorrect_map && ls)
A_template=$(find ./ -name A_template)
L_template=$(find ./ -name L_template)
C_template=$(find ./ -name C_template)
cy_template=$(find ./ -name cy_template)
pl_template=$(find ./ -name pl_template)
sp_template=$(find ./ -name sp_template)
normal_template=$(find ./ -name normal_template)

A_cases=$(find ./ -name A_cases)
L_cases=$(find ./ -name L_cases)
C_cases=$(find ./ -name C_cases)
cy_cases=$(find ./ -name cy_cases)
pl_cases=$(find ./ -name pl_cases)
sp_cases=$(find ./ -name sp_cases)
random_cases=$(find ./ -name random_cases)

make -C ../  
i="1"
for map in $incorrect_maps
do
	echo -ne "${YEL}${i} - $map:${RESET}"
	$exe $map 2> /dev/null
	exit_code=$(echo $?)
	if [[ $exit_code != 1 ]]; then
	echo -e "${RED} KO ${RESET}"
	else
	echo -e "${GRN} OK ${RESET}"
	fi
	i=$((i+1))
done

echo -e "${BLU}A Cases${RESET}"
line_count=$(wc -l $A_template | awk '{print $1}' )
while IFS= read -r line; do
	echo -ne "${YEL}${i} - $line:${RESET}"
	random_line=$(shuf -i1-$line_count -n1)
	sed "$random_line i $line" $A_template > temp.rt
	timeout --preserve-status 1s $exe temp.rt
	exit_code=$(echo $?)
	if [[ $exit_code != 1 ]]; then
	echo -e "${RED} KO ${RESET}"
	else
	echo -e "${GRN} OK ${RESET}"
	fi
	i=$((i+1))
done < $A_cases

# rm -rf temp.rt